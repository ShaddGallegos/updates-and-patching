# Configuration for RHEL systems - supports both yum and dnf
# Compatible with RHEL 7, 8, 9, and 10
{% if ansible_facts['os_family'] == 'RedHat' and ansible_facts['distribution'] in ['RedHat', 'Red Hat Enterprise Linux'] %}
{% set rhel_version = ansible_facts['distribution_major_version']|int %}
[main]
# Cache directory - version-specific for optimal performance
{% if rhel_version >= 8 %}
cachedir=/var/cache/dnf/$basearch/$releasever
{% else %}
cachedir=/var/cache/yum/$basearch/$releasever
{% endif %}

# Core package manager settings
keepcache=0
debuglevel=2
{% if rhel_version >= 8 %}
logfile=/var/log/dnf.log
{% else %}
logfile=/var/log/yum.log
{% endif %}
exactarch=1
obsoletes=1
gpgcheck=1
plugins=1
{% if rhel_version >= 10 %}
installonly_limit=5
{% else %}
installonly_limit=3
{% endif %}
minrate=1
{% if rhel_version >= 9 %}
timeout=600
{% else %}
timeout=300
{% endif %}

# Skip unavailable repositories instead of failing
skip_if_unavailable=1

# Version-specific optimizations
{% if rhel_version >= 8 %}
best=1
clean_requirements_on_remove=1
{% if rhel_version >= 9 %}
zchunk=1
countme=1
fastestmirror=1
{% endif %}
{% if rhel_version >= 10 %}
module_hotfixes=1
protect_running_kernel=1
{% endif %}
{% endif %}

# Security settings
{% if rhel_version >= 8 %}
localpkg_gpgcheck=1
repo_gpgcheck=0
{% endif %}

# Metadata settings
{% if rhel_version >= 9 %}
# metadata_expire=6h
{% else %}
# metadata_expire=90m
{% endif %}

# Repository configuration
# PUT YOUR REPOS HERE OR IN separate files named file.repo
# in /etc/yum.repos.d (RHEL 7) or /etc/dnf/dnf.conf.d (RHEL 8+)
{% else %}
# This configuration is only for Red Hat Enterprise Linux systems (RHEL 7, 8, 9, 10)
# Current system: {{ ansible_facts['distribution'] }} {{ ansible_facts['distribution_version'] }}
# Supported: Red Hat Enterprise Linux 7.x, 8.x, 9.x, 10.x
# This template requires RHEL to function properly
{% endif %}
